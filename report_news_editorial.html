
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AgriNexus - ë‰´ìŠ¤ ê¸°ë°˜ ë¦¬í¬íŠ¸ + ìš”ì•½</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>ğŸŒ AgriNexus ë‰´ìŠ¤ ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ë¦¬í¬íŠ¸</h1>
  <label>êµ­ê°€ ì„ íƒ:
    <select id="country" onchange="loadNews(this.value)">
      <option value="">-- ì„ íƒ --</option>
      <option value="korea">ëŒ€í•œë¯¼êµ­</option>
      <option value="usa">ë¯¸êµ­</option>
    </select>
  </label>
  <div id="newsResult" style="margin-top:20px; background:#f5f5f5; padding:15px; border-radius:8px;"></div>
  <button onclick="downloadPDF()">ğŸ“„ PDF ì €ì¥</button>

  <script>
    let summaryText = "";

    async function loadNews(country) {
      const box = document.getElementById("newsResult");
      box.innerHTML = "ğŸ” ë‰´ìŠ¤ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
      const gRes = await fetch(`https://gnews.io/api/v4/search?q=agriculture+${country}&lang=ko&token=a34d3044fa3358cbfb412a39d9ac0bcc`);
      const data = await gRes.json();
      const article = data.articles?.[0];

      if (!article) {
        box.innerHTML = "âŒ ë‰´ìŠ¤ ì—†ìŒ";
        return;
      }

      const aiRes = await fetch("https://api.openai.com/v1/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({
          model: "text-davinci-003",
          prompt: "ë‹¤ìŒ ê¸°ì‚¬ ë‚´ìš©ì„ í•œêµ­ì–´ ë‰´ìŠ¤ ì‚¬ì„¤ì²˜ëŸ¼ ìš”ì•½í•´ì¤˜:\n" + article.description,
          max_tokens: 300
        })
      });

      const aiData = await aiRes.json();
      summaryText = aiData.choices?.[0]?.text || "ìš”ì•½ ì‹¤íŒ¨";

      box.innerHTML = `
        <h3>${article.title}</h3>
        <p><b>ìš”ì•½ (AI):</b> ${summaryText}</p>
        <p><b>ì¶œì²˜:</b> ${article.source.name}</p>
        <p><b>ë³¸ë¬¸:</b> ${article.description}</p>
      `;
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text(summaryText, 10, 10);
      doc.save("AgriNexus_AI_ìš”ì•½.pdf");
    }
  </script>
</body>
</html>
