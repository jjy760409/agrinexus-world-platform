
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AgriNexus ì •ì±…â†’IoT ì—°ë™ + ìë™ ì˜ˆì¸¡ + ìŠ¹ì¸ ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; background: #f5f9fc; padding: 2rem; text-align: center; }
    .section { background: white; padding: 1.5rem; margin: 2rem auto; max-width: 800px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
    input, button, textarea { padding: 0.8rem; width: 90%; max-width: 500px; margin: 0.5rem; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; }
    canvas { margin-top: 2rem; background: white; border-radius: 10px; }
  </style>
</head>
<body>

  <h1>ğŸ¤– AgriNexus ì •ì±…â†’IoT + ì˜ˆì¸¡ ì•Œë¦¼ + ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ì‹œë³´ë“œ</h1>

  <div class="section">
    <h3>ğŸ“¡ ì •ì±…ì— ë”°ë¥¸ IoT ìë™ ëª…ë ¹ ì „ì†¡</h3>
    <textarea id="policyInput" placeholder="ì •ì±… ë‚´ìš© ì…ë ¥ (ì˜ˆ: í† ì–‘ ìˆ˜ë¶„ ë¶€ì¡± ì‹œ ê´€ìˆ˜)"></textarea>
    <button onclick="policyToIoT()">IoT ëª…ë ¹ ìë™ ì‹¤í–‰</button>
    <div id="iotStatus" style="margin-top:1rem; color:#007c4d;"></div>
  </div>

  <div class="section">
    <h3>ğŸ“ˆ ìµœì  ê²½ë¡œ ê¸°ë°˜ ìë™ ì˜ˆì¸¡/ì•Œë¦¼ ìƒì„±</h3>
    <button onclick="predictAndNotify()">ìë™ ì˜ˆì¸¡ + ì•Œë¦¼ ìƒì„±</button>
    <div id="predictionStatus" style="margin-top:1rem; font-weight:bold;"></div>
  </div>

  <div class="section">
    <h3>ğŸ§¾ ê´€ë¦¬ì ìŠ¹ì¸ UI + ìŠ¹ì¸ ìƒíƒœ ëŒ€ì‹œë³´ë“œ</h3>
    <textarea id="approvalNote" placeholder="ê´€ë¦¬ì ìŠ¹ì¸ ì½”ë©˜íŠ¸ ì…ë ¥"></textarea>
    <button onclick="saveApproval()">ìŠ¹ì¸ ì €ì¥</button>
    <canvas id="approvalChart" width="700" height="300"></canvas>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function policyToIoT() {
      const policy = document.getElementById("policyInput").value;
      const command = policy.includes("ê´€ìˆ˜") ? "water-start" : "vent-open";

      db.ref("iotCommands").push({ policy, command, time: new Date().toISOString() });

      fetch("https://iot-server.example.com/control", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ command })
      });

      document.getElementById("iotStatus").innerText = `ğŸš€ IoT ëª…ë ¹ ì „ì†¡ ì™„ë£Œ: ${command}`;
    }

    function predictAndNotify() {
      const bestPath = "ì˜ˆì¸¡ â†’ ìŠ¹ì¸ â†’ ì œì–´"; // ì˜ˆì‹œ
      const message = `ğŸ”” ìë™ ì˜ˆì¸¡ ê²½ë¡œ í™œì„±í™”ë¨: ${bestPath}`;
      db.ref("alerts").push({ message, time: new Date().toISOString(), auto: true });
      document.getElementById("predictionStatus").innerText = message;
    }

    function saveApproval() {
      const note = document.getElementById("approvalNote").value;
      db.ref("approvals").push({ note, approved: true, time: new Date().toISOString() });
    }

    db.ref("approvals").on("value", snapshot => {
      const data = snapshot.val() || {};
      const labels = [], values = [];
      for (const key in data) {
        const label = data[key].note?.slice(0, 10) || "ê¸°íƒ€";
        labels.push(label);
        values.push(1);
      }
      const ctx = document.getElementById("approvalChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "ê´€ë¦¬ì ìŠ¹ì¸ ë¡œê·¸",
            data: values,
            backgroundColor: "#007c4d"
          }]
        },
        options: { responsive: true }
      });
    });
  </script>

</body>
</html>
