
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriNexus ì‘ë¬¼ ëª¨ë¸ ì—°ë™ + ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ + Functions</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; background: #f5f8fa; text-align: center; padding: 2rem; }
    input, button { width: 90%; max-width: 500px; padding: 0.7rem; font-size: 1rem; margin: 0.5rem; border-radius: 6px; border: 1px solid #ccc; }
    canvas { background: white; margin-top: 2rem; border-radius: 10px; }
    .block { background: white; border-radius: 10px; margin: 1rem auto; max-width: 800px; padding: 1.5rem; box-shadow: 0 0 8px rgba(0,0,0,0.05); }
  </style>
</head>
<body>

  <h1>ğŸŒ± AgriNexus ì‘ë¬¼ ëª¨ë¸ + ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ + Functions</h1>

  <div class="block">
    <h3>ğŸ” ì‘ë¬¼ ëª¨ë¸ ë¡œë“œ (TFLite ë³€í™˜ ëª¨ë¸)</h3>
    <button onclick="loadModel()">ëª¨ë¸ ë¡œë“œ</button>
    <div id="modelStatus"></div>
  </div>

  <div class="block">
    <h3>ğŸ“Š ê´€ë¦¬ì ë¦¬í¬íŠ¸ ì‹œê°í™” (Firebase)</h3>
    <canvas id="reportChart" width="700" height="300"></canvas>
  </div>

  <div class="block">
    <h3>â˜ï¸ Firebase Functionsë¡œ ë¦¬í¬íŠ¸ ìë™ ì²˜ë¦¬</h3>
    <input id="email" placeholder="ì´ë©”ì¼ ì…ë ¥" />
    <input id="summary" placeholder="ìš”ì•½/ì½”ë©˜íŠ¸ ì…ë ¥" />
    <button onclick="sendToFunction()">ë³´ê³ ì„œ Functions í˜¸ì¶œ</button>
    <div id="fnStatus" style="color:#007c4d;"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function loadModel() {
      const modelURL = "https://your-storage.com/tflite/converted-model/model.json";  // ì‹¤ì œ TFLite converted model
      const model = await tf.loadGraphModel(modelURL);
      document.getElementById("modelStatus").innerText = "âœ… ì‘ë¬¼ ëª¨ë¸ ë¡œë“œ ì™„ë£Œ!";
    }

    db.ref("reports").on("value", (snapshot) => {
      const data = snapshot.val();
      const labels = [], values = [];
      for (const key in data) {
        labels.push(new Date(data[key].time).toLocaleString());
        values.push(data[key].summary?.length || 1);
      }
      const ctx = document.getElementById("reportChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "ì œì¶œëœ ë³´ê³ ì„œ ìš”ì•½ ê¸¸ì´",
            data: values,
            backgroundColor: "#007c4d"
          }]
        },
        options: { responsive: true }
      });
    });

    async function sendToFunction() {
      const email = document.getElementById("email").value;
      const summary = document.getElementById("summary").value;
      const res = await fetch("https://us-central1-your-project.cloudfunctions.net/processReport", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, summary, time: new Date().toISOString() })
      });
      const data = await res.json();
      document.getElementById("fnStatus").innerText = "ğŸ“© ì²˜ë¦¬ ê²°ê³¼: " + data.status;
    }
  </script>

</body>
</html>
