
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>AgriNexus 서명 포함 계약 PDF 생성</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial; padding: 2rem; background: #f4f4f4; }
    input, textarea, button { width: 100%; padding: 0.8rem; margin-top: 1rem; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #007c4d; color: white; border: none; cursor: pointer; }
    h2 { color: #004b8d; margin-top: 2rem; }
    img { margin-top: 1rem; border: 1px solid #ccc; max-width: 300px; }
  </style>
</head>
<body>
  <h1>📄 AgriNexus 서명 포함 계약서 PDF 생성기</h1>

  <h2>① 계약 내용 입력</h2>
  <textarea id="contractText" rows="10" placeholder="GPT 또는 사용자가 생성한 계약 내용을 입력하세요..."></textarea>

  <h2>② 서명 이미지 업로드</h2>
  <input type="file" id="signatureImage" accept="image/*"/>
  <img id="previewImage"/>

  <h2>③ PDF 생성 및 병합</h2>
  <button onclick="generateSignedPDF()">📥 서명 포함 PDF 생성</button>

  <script>
    let uploadedSignature = null;

    document.getElementById("signatureImage").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          uploadedSignature = evt.target.result;
          document.getElementById("previewImage").src = uploadedSignature;
        };
        reader.readAsDataURL(file);
      }
    });

    async function generateSignedPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const text = document.getElementById("contractText").value;
      const lines = doc.splitTextToSize(text, 180);
      doc.text(lines, 15, 20);

      if (uploadedSignature) {
        doc.addImage(uploadedSignature, 'PNG', 15, 250, 80, 30);
        doc.text("서명:", 15, 245);
      }

      doc.save("AgriNexus_Contract_Signed_Merged.pdf");
    }
  </script>
</body>
</html>
