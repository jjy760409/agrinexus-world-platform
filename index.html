
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AgriNexus ê¶Œí•œë³„ ì•Œë¦¼ + GPT ìë™ ìƒì„±</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; background: #f3f9fc; text-align: center; padding: 2rem; }
    input, button, textarea { padding: 0.8rem; font-size: 1rem; width: 90%; max-width: 500px; margin: 0.4rem; border-radius: 6px; border: 1px solid #ccc; }
    .admin-only { display: none; background: white; padding: 1rem; margin: 1rem auto; border-radius: 12px; max-width: 800px; box-shadow: 0 0 8px rgba(0,0,0,0.05); }
    canvas { margin-top: 1rem; }
  </style>
</head>
<body>

  <h1>ğŸ” AgriNexus ê¶Œí•œ ê¸°ë°˜ ì•Œë¦¼ ì‹œìŠ¤í…œ + GPT ìë™ ë©”ì‹œì§€</h1>

  <input id="email" placeholder="ì´ë©”ì¼" />
  <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
  <button onclick="login()">ë¡œê·¸ì¸</button>
  <div id="authStatus" style="color:#007c4d; margin-top:1rem;"></div>

  <div class="admin-only" id="adminPanel">
    <h3>ğŸ“Š ì•Œë¦¼ ì „ì†¡ ì´ë ¥ ì‹œê°í™”</h3>
    <canvas id="alertChart" width="700" height="300"></canvas>
  </div>

  <div class="admin-only" id="gptPanel">
    <h3>ğŸ§  GPT ê¸°ë°˜ ìë™ ì•Œë¦¼ ì½˜í…ì¸  ìƒì„± (ì˜ˆì‹œ)</h3>
    <textarea id="topic" placeholder="ì•Œë¦¼ ì£¼ì œ ì…ë ¥ (ì˜ˆ: ìˆ˜ë¶„ ë¶€ì¡± ê²½ê³ )"></textarea>
    <button onclick="generateMessage()">ìë™ ë©”ì‹œì§€ ìƒì„±</button>
    <div id="gptMessage" style="margin-top:1rem; font-weight:bold;"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function login() {
      const email = document.getElementById("email").value;
      const pw = document.getElementById("password").value;

      auth.signInWithEmailAndPassword(email, pw).then((cred) => {
        document.getElementById("authStatus").innerText = "âœ… ë¡œê·¸ì¸ ì„±ê³µ: " + email;
        const isAdmin = email.includes("admin"); // ê°„ë‹¨í•œ ê¶Œí•œ êµ¬ë¶„
        if (isAdmin) {
          document.getElementById("adminPanel").style.display = "block";
          document.getElementById("gptPanel").style.display = "block";
          loadAlertLogs();
        }
      }).catch(err => {
        document.getElementById("authStatus").innerText = "âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + err.message;
      });
    }

    function loadAlertLogs() {
      db.ref("alerts").once("value").then(snapshot => {
        const data = snapshot.val() || {};
        const labels = [], statuses = [];
        for (const key in data) {
          labels.push(new Date(data[key].time).toLocaleString());
          statuses.push(data[key].status === "ì„±ê³µ" ? 1 : 0);
        }
        const ctx = document.getElementById("alertChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: [{
              label: "ì „ì†¡ ì„±ê³µ ì—¬ë¶€ (1=ì„±ê³µ, 0=ì‹¤íŒ¨)",
              data: statuses,
              borderColor: "#007c4d",
              fill: false
            }]
          },
          options: { responsive: true }
        });
      });
    }

    function generateMessage() {
      const topic = document.getElementById("topic").value;
      const message = `ğŸš¨ AgriNexus ì•Œë¦¼: "${topic}" ìƒí™©ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹ ë¥¸ ì¡°ì¹˜ ë°”ëë‹ˆë‹¤.`;
      document.getElementById("gptMessage").innerText = message;
    }
  </script>

</body>
</html>
