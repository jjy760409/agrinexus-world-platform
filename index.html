
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AgriNexus AI ì˜ˆì¸¡ + PDF + ì´ë©”ì¼ + DB + TF.js</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 2rem; background: #eef6f9; text-align: center; }
    input, button { padding: 0.7rem; margin: 0.4rem; border-radius: 6px; font-size: 1rem; width: 90%; max-width: 500px; }
    canvas { margin-top: 2rem; background: white; border-radius: 8px; }
    .output { margin-top: 1rem; color: #007c4d; font-size: 1.1rem; }
  </style>
</head>
<body>

  <h1>ğŸŒ¾ AgriNexus ì˜ˆì¸¡ + PDF ë¦¬í¬íŠ¸ + DB ì €ì¥ + ë©”ì¼ ë°œì†¡</h1>

  <input id="email" placeholder="ğŸ“§ ì´ë©”ì¼ ì£¼ì†Œ" /><br/>
  ì¼ì‚¬ëŸ‰ (W/mÂ²): <input id="sun" type="number" /><br/>
  ìˆ˜ë¶„ (%): <input id="moist" type="number" /><br/>
  ì˜¨ë„ (Â°C): <input id="temp" type="number" /><br/>
  <button onclick="predictGrowth()">AI ì˜ˆì¸¡</button>
  <button onclick="generateAndSend()">ğŸ“„ PDF ìƒì„± + ì´ë©”ì¼ ë°œì†¡</button>

  <div class="output" id="predictionOut"></div>
  <canvas id="growthChart" width="700" height="300"></canvas>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const growthData = [];

    async function predictGrowth() {
      const sun = parseFloat(document.getElementById("sun").value);
      const moist = parseFloat(document.getElementById("moist").value);
      const temp = parseFloat(document.getElementById("temp").value);
      const email = document.getElementById("email").value;

      // Firebase ì €ì¥
      db.ref("growthLogs").push({ sun, moist, temp, email, time: new Date().toISOString() });

      // ê°„ë‹¨í•œ ì˜ˆì¸¡
      let result = "ğŸŒ± ì •ìƒ";
      if (sun < 200 || moist < 20 || temp < 10) result = "âš ï¸ ì €ì¡°";
      else if (moist > 80 && temp > 30) result = "ğŸ’§ ê³¼ì‰";
      document.getElementById("predictionOut").innerText = "ì˜ˆì¸¡ ê²°ê³¼: " + result;

      growthData.push({ x: new Date().toISOString(), y: moist });
      renderChart();
    }

    function renderChart() {
      const ctx = document.getElementById("growthChart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: {
          datasets: [{
            label: "ğŸŒ¿ í† ì–‘ ìˆ˜ë¶„ ì¶”ì ",
            data: growthData,
            borderColor: "#007c4d",
            fill: false
          }]
        },
        options: {
          parsing: false,
          scales: {
            x: { type: 'time', time: { unit: 'minute' }, title: { display: true, text: 'ì‹œê°„' } },
            y: { beginAtZero: true, max: 100, title: { display: true, text: 'ìˆ˜ë¶„ (%)' } }
          }
        }
      });
    }

    async function generateAndSend() {
      const { jsPDF } = window.jspdf;
      const email = document.getElementById("email").value;
      const sun = document.getElementById("sun").value;
      const moist = document.getElementById("moist").value;
      const temp = document.getElementById("temp").value;
      const pred = document.getElementById("predictionOut").innerText;

      const doc = new jsPDF();
      doc.text("ğŸŒ¾ AgriNexus ì‘ë¬¼ ìƒìœ¡ ì˜ˆì¸¡ ë¦¬í¬íŠ¸", 20, 20);
      doc.text(`ì´ë©”ì¼: ${email}`, 20, 30);
      doc.text(`ì¼ì‚¬ëŸ‰: ${sun}`, 20, 40);
      doc.text(`ìˆ˜ë¶„: ${moist}`, 20, 50);
      doc.text(`ì˜¨ë„: ${temp}`, 20, 60);
      doc.text(`ì˜ˆì¸¡ ê²°ê³¼: ${pred}`, 20, 80);
      doc.text(`ë°œí–‰ì¼: ${new Date().toLocaleString()}`, 20, 100);

      const pdfBlob = doc.output("blob");

      const formData = new FormData();
      formData.append("pdf", pdfBlob, "AgriNexus_Report.pdf");
      formData.append("email", email);

      // Mail ì „ì†¡ API í˜¸ì¶œ (ì„œë²„ í•„ìš”)
      await fetch("https://your-server.com/send-report", {
        method: "POST",
        body: formData
      });

      alert("âœ… PDF ë¦¬í¬íŠ¸ê°€ ë©”ì¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
  </script>

</body>
</html>
