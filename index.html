
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AgriNexus ëŒ€í™”í˜• GPT | ë‹¨ê³„ë³„ ì‹¤í–‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial; background: #f0f8f5; padding: 2rem; text-align: center; color: #1e3a34; }
    textarea, input, button {
      width: 90%; max-width: 700px; padding: 1rem; font-size: 1rem; margin: 0.5rem auto; border-radius: 6px; border: 1px solid #ccc; display: block;
    }
    button { background: #007c4d; color: white; border: none; cursor: pointer; }
    .response { margin-top: 1rem; background: #eaf6ef; padding: 1rem; border-radius: 8px; min-height: 80px; }
    .next { display: none; margin-top: 1rem; }
  </style>
</head>
<body>

<h2>ğŸŒ± AgriNexus ì „ìš© GPT ëŒ€í™” + ë‹¨ê³„ë³„ ì‹¤í–‰</h2>
<input id="user" placeholder="ì‚¬ìš©ì ì´ë©”ì¼ (ì˜ˆ: user@example.com)" />
<textarea id="prompt" rows="4" placeholder="ìŠ¤ë§ˆíŠ¸íŒœ ì„¤ê³„ì— ëŒ€í•´ ì§ˆë¬¸í•˜ì„¸ìš”">ìŠ¤ë§ˆíŠ¸íŒœ ì„¤ê³„</textarea>
<button onclick="sendGPT()">GPT ì‹¤í–‰</button>
<div class="response" id="output">GPT ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

<div class="next" id="nextStep">
  <button onclick="createPolicy()">ì´ ì„¤ê³„ë¡œ ì •ì±… ìƒì„±í•˜ê¸°</button>
  <button onclick="triggerIoT()">IoT ì‹¤í–‰</button>
  <button onclick="generateReport()">ë³´ê³ ì„œ ìƒì„± + ë©”ì¼ ì „ì†¡</button>
</div>

<script>
let history = [];

async function sendGPT() {
  const prompt = document.getElementById("prompt").value;
  const user = document.getElementById("user").value;
  document.getElementById("output").innerText = "ì‘ë‹µ ìƒì„± ì¤‘...";
  const res = await fetch("/gptChat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ user, messages: history.concat({ role: "user", content: prompt }) })
  });
  const data = await res.json();
  const reply = data.reply || "âŒ ì˜¤ë¥˜ ë°œìƒ";
  document.getElementById("output").innerText = reply;
  history.push({ role: "user", content: prompt });
  history.push({ role: "assistant", content: reply });
  document.getElementById("nextStep").style.display = "block";
}

function createPolicy() {
  alert("âœ… ì •ì±… ìƒì„±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
function triggerIoT() {
  alert("ğŸ“¡ IoT ëª…ë ¹ ì „ì†¡ë¨ (ì˜ˆ: í™˜ê¸°)");
}
function generateReport() {
  alert("ğŸ“„ ë³´ê³ ì„œê°€ ìƒì„±ë˜ì–´ ê´€ë¦¬ìì—ê²Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
</script>

</body>
</html>
