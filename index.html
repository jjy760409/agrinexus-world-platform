
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriNexus Mail + TF Model + Firebase 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 2rem; background: #f6f9fc; text-align: center; }
    canvas { margin-top: 2rem; background: white; border-radius: 10px; }
    .section { margin: 2rem auto; max-width: 700px; background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.08); }
    input, button { width: 90%; padding: 0.8rem; font-size: 1rem; margin-top: 0.5rem; border-radius: 6px; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <h1>📊 AgriNexus 관리자 리포트 + 메일 발송 + TF 모델 예측</h1>

  <div class="section">
    <h3>📈 Firebase 실시간 생육 로그 시각화</h3>
    <canvas id="logChart" width="700" height="300"></canvas>
  </div>

  <div class="section">
    <h3>✉️ 메일 발송 (PDF 리포트 전송)</h3>
    <input id="email" type="email" placeholder="이메일 주소 입력" />
    <button onclick="sendMail()">메일로 리포트 전송</button>
    <div id="mailStatus" style="margin-top:1rem; color:#007c4d;"></div>
  </div>

  <div class="section">
    <h3>🤖 TensorFlow.js 생육 상태 분류 예시</h3>
    <button onclick="runTFModel()">AI 분류 실행</button>
    <div id="tfOut" style="margin-top:1rem; font-weight:bold;"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref("growthLogs").on("value", (snapshot) => {
      const data = snapshot.val();
      const labels = [], values = [];
      for (const key in data) {
        labels.push(new Date(data[key].time).toLocaleString());
        values.push(data[key].moist);
      }
      const ctx = document.getElementById("logChart").getContext("2d");
      new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "토양 수분 (%)",
            data: values,
            borderColor: "#007c4d",
            fill: false
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'top' }},
          scales: {
            y: { beginAtZero: true, max: 100 }
          }
        }
      });
    });

    function sendMail() {
      const email = document.getElementById("email").value;
      fetch("https://your-server.com/send-report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      }).then(r => r.json())
        .then(data => {
          document.getElementById("mailStatus").innerText = "✅ " + data.status;
        });
    }

    async function runTFModel() {
      // TensorFlow 모델 로드 및 예측 (예시)
      const model = await tf.loadLayersModel("https://storage.googleapis.com/tfjs-models/tfjs/iris_v1/model.json");
      const input = tf.tensor2d([[5.1, 3.5, 1.4, 0.2]]);
      const prediction = model.predict(input);
      prediction.array().then(arr => {
        const max = arr[0].indexOf(Math.max(...arr[0]));
        const label = ["Setosa", "Versicolor", "Virginica"][max];
        document.getElementById("tfOut").innerText = `예측된 작물 클래스: ${label}`;
      });
    }
  </script>

</body>
</html>
