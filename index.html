
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AgriNexus 정책→IoT 연동 + 자동 예측 + 승인 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; background: #f5f9fc; padding: 2rem; text-align: center; }
    .section { background: white; padding: 1.5rem; margin: 2rem auto; max-width: 800px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
    input, button, textarea { padding: 0.8rem; width: 90%; max-width: 500px; margin: 0.5rem; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; }
    canvas { margin-top: 2rem; background: white; border-radius: 10px; }
  </style>
</head>
<body>

  <h1>🤖 AgriNexus 정책→IoT + 예측 알림 + 관리자 승인 대시보드</h1>

  <div class="section">
    <h3>📡 정책에 따른 IoT 자동 명령 전송</h3>
    <textarea id="policyInput" placeholder="정책 내용 입력 (예: 토양 수분 부족 시 관수)"></textarea>
    <button onclick="policyToIoT()">IoT 명령 자동 실행</button>
    <div id="iotStatus" style="margin-top:1rem; color:#007c4d;"></div>
  </div>

  <div class="section">
    <h3>📈 최적 경로 기반 자동 예측/알림 생성</h3>
    <button onclick="predictAndNotify()">자동 예측 + 알림 생성</button>
    <div id="predictionStatus" style="margin-top:1rem; font-weight:bold;"></div>
  </div>

  <div class="section">
    <h3>🧾 관리자 승인 UI + 승인 상태 대시보드</h3>
    <textarea id="approvalNote" placeholder="관리자 승인 코멘트 입력"></textarea>
    <button onclick="saveApproval()">승인 저장</button>
    <canvas id="approvalChart" width="700" height="300"></canvas>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function policyToIoT() {
      const policy = document.getElementById("policyInput").value;
      const command = policy.includes("관수") ? "water-start" : "vent-open";

      db.ref("iotCommands").push({ policy, command, time: new Date().toISOString() });

      fetch("https://iot-server.example.com/control", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ command })
      });

      document.getElementById("iotStatus").innerText = `🚀 IoT 명령 전송 완료: ${command}`;
    }

    function predictAndNotify() {
      const bestPath = "예측 → 승인 → 제어"; // 예시
      const message = `🔔 자동 예측 경로 활성화됨: ${bestPath}`;
      db.ref("alerts").push({ message, time: new Date().toISOString(), auto: true });
      document.getElementById("predictionStatus").innerText = message;
    }

    function saveApproval() {
      const note = document.getElementById("approvalNote").value;
      db.ref("approvals").push({ note, approved: true, time: new Date().toISOString() });
    }

    db.ref("approvals").on("value", snapshot => {
      const data = snapshot.val() || {};
      const labels = [], values = [];
      for (const key in data) {
        const label = data[key].note?.slice(0, 10) || "기타";
        labels.push(label);
        values.push(1);
      }
      const ctx = document.getElementById("approvalChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "관리자 승인 로그",
            data: values,
            backgroundColor: "#007c4d"
          }]
        },
        options: { responsive: true }
      });
    });
  </script>

</body>
</html>
