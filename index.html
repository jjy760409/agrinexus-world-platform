
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AgriNexus κ³„μ•½ μλ™ μƒμ„± + PDF</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial; padding: 2rem; background: #f0f0f0; }
    h1, h2 { color: #004b8d; }
    input, textarea, button { width: 100%; padding: 0.8rem; margin-top: 1rem; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #007c4d; color: white; border: none; cursor: pointer; }
    #contractResult { white-space: pre-wrap; background: white; padding: 1rem; margin-top: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>π“„ AgriNexus κ³„μ•½μ„ μλ™ μƒμ„± + PDF λ””μμΈ</h1>

  <h2>β‘  κ³„μ•½ μ΅°κ±΄ μ…λ ¥</h2>
  <input id="partyA" placeholder="κ³„μ•½ λ‹Ήμ‚¬μ A" />
  <input id="partyB" placeholder="κ³„μ•½ λ‹Ήμ‚¬μ B" />
  <textarea id="terms" placeholder="κ°„λ‹¨ν• κ³„μ•½ μ„¤λ… (μ: μ¤λ§νΈν μ„¤μΉ, μμ¶ κ³„μ•½ λ“±)" rows="3"></textarea>
  <input id="date" type="date" />
  <button onclick="generateWithGPT()">π¤– GPTλ΅ κ³„μ•½μ„ μλ™ μƒμ„±</button>

  <h2>β‘΅ μ „μμ„λ…</h2>
  <input id="signature" placeholder="μ „μμ„λ… (μ΄λ¦„ λλ” μ΄λ‹μ…)" />
  <button onclick="downloadStyledPDF()">π“¥ PDF λ‹¤μ΄λ΅λ“</button>

  <div id="contractResult">GPTκ°€ μ‘μ„±ν• κ³„μ•½μ„κ°€ μ—¬κΈ°μ— ν‘μ‹λ©λ‹λ‹¤...</div>

  <script>
    async function generateWithGPT() {
      const a = document.getElementById("partyA").value;
      const b = document.getElementById("partyB").value;
      const t = document.getElementById("terms").value;
      const d = document.getElementById("date").value;

      const prompt = `
λ‹¤μ μ •λ³΄λ΅ κ°„λ‹¨ν•κ³  λ…ν™•ν• κ³µμ‹ κ³„μ•½μ„λ¥Ό μ‘μ„±ν•΄μ¤.

κ³„μ•½ λ‹Ήμ‚¬μ A: ${a}
κ³„μ•½ λ‹Ήμ‚¬μ B: ${b}
κ³„μ•½ λ‚΄μ© μ”μ•½: ${t}
κ³„μ•½ λ‚ μ§: ${d}
      `;

      const responseBox = document.getElementById("contractResult");
      responseBox.innerText = "β³ GPTκ°€ κ³„μ•½μ„λ¥Ό μƒμ„± μ¤‘μ…λ‹λ‹¤...";

      try {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer YOUR_OPENAI_API_KEY"
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: prompt }]
          })
        });
        const data = await res.json();
        const contractText = data.choices[0].message.content;
        responseBox.innerText = contractText;
        window.latestContract = contractText;
      } catch (err) {
        responseBox.innerText = "β μ¤λ¥ λ°μƒ: " + err.message;
      }
    }

    async function downloadStyledPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const text = window.latestContract || document.getElementById("contractResult").innerText;
      const signature = document.getElementById("signature").value;

      doc.setFontSize(14);
      doc.text("AgriNexus κ³µμ‹ κ³„μ•½μ„", 20, 20);
      doc.setFontSize(11);

      const lines = doc.splitTextToSize(text + "

μ „μμ„λ…: " + signature, 170);
      doc.text(lines, 20, 30);
      doc.save("AgriNexus_Contract_Generated.pdf");
    }
  </script>
</body>
</html>
