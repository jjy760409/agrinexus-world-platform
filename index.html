
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AgriNexus Netlify + Logs + ì´ë¯¸ì§€ ì§„ë‹¨</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2"></script>
  <style>
    body { font-family: Arial; background: #f5fafd; padding: 2rem; text-align: center; }
    input, button { padding: 0.8rem; font-size: 1rem; margin: 0.5rem; width: 90%; max-width: 500px; border-radius: 6px; border: 1px solid #ccc; }
    canvas, img { margin-top: 1rem; max-width: 100%; border-radius: 8px; }
    .log { color: #007c4d; margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>

  <h1>ğŸš€ AgriNexus Netlify í”Œë«í¼ + ë³´ê³ ì„œ ë¡œê·¸ + ì´ë¯¸ì§€ AI ì§„ë‹¨</h1>

  <div>
    <h3>ğŸ“„ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ ë¡œê·¸ ë¶„ì„</h3>
    <button onclick="logDownload()">ğŸ“¥ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ</button>
    <div class="log" id="logResult"></div>
  </div>

  <div>
    <h3>ğŸŒ¿ ì‘ë¬¼ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ë°˜ ì§„ë‹¨</h3>
    <input type="file" id="imageUpload" accept="image/*" />
    <img id="preview" style="display:none;" />
    <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
    <button onclick="detectImage()">ğŸ” AI ì‘ë¬¼ ì´ë¯¸ì§€ ì§„ë‹¨</button>
    <div class="log" id="aiResult"></div>
  </div>

  <script>
    function logDownload() {
      const time = new Date().toLocaleString();
      localStorage.setItem("lastDownload", time);
      document.getElementById("logResult").innerText = "ğŸ“Œ ìµœê·¼ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ ì‹œê°: " + time;
    }

    let model;

    async function detectImage() {
      const file = document.getElementById("imageUpload").files[0];
      const img = document.getElementById("preview");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      if (!file) return alert("ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");

      const reader = new FileReader();
      reader.onload = async () => {
        img.src = reader.result;
        img.onload = async () => {
          canvas.style.display = "block";
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          if (!model) model = await cocoSsd.load();
          const predictions = await model.detect(canvas);
          predictions.forEach(pred => {
            ctx.strokeStyle = "#007c4d";
            ctx.lineWidth = 2;
            ctx.strokeRect(...pred.bbox);
            ctx.fillStyle = "#007c4d";
            ctx.fillText(pred.class + " " + Math.round(pred.score * 100) + "%", pred.bbox[0], pred.bbox[1] - 5);
          });
          document.getElementById("aiResult").innerText = `ì˜ˆì¸¡ëœ í•­ëª© ìˆ˜: ${predictions.length}`;
        };
      };
      reader.readAsDataURL(file);
      img.style.display = "block";
    }
  </script>

</body>
</html>
