
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriNexus 작물 모델 연동 + 관리자 대시보드 + Functions</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; background: #f5f8fa; text-align: center; padding: 2rem; }
    input, button { width: 90%; max-width: 500px; padding: 0.7rem; font-size: 1rem; margin: 0.5rem; border-radius: 6px; border: 1px solid #ccc; }
    canvas { background: white; margin-top: 2rem; border-radius: 10px; }
    .block { background: white; border-radius: 10px; margin: 1rem auto; max-width: 800px; padding: 1.5rem; box-shadow: 0 0 8px rgba(0,0,0,0.05); }
  </style>
</head>
<body>

  <h1>🌱 AgriNexus 작물 모델 + 관리자 대시보드 + Functions</h1>

  <div class="block">
    <h3>🔍 작물 모델 로드 (TFLite 변환 모델)</h3>
    <button onclick="loadModel()">모델 로드</button>
    <div id="modelStatus"></div>
  </div>

  <div class="block">
    <h3>📊 관리자 리포트 시각화 (Firebase)</h3>
    <canvas id="reportChart" width="700" height="300"></canvas>
  </div>

  <div class="block">
    <h3>☁️ Firebase Functions로 리포트 자동 처리</h3>
    <input id="email" placeholder="이메일 입력" />
    <input id="summary" placeholder="요약/코멘트 입력" />
    <button onclick="sendToFunction()">보고서 Functions 호출</button>
    <div id="fnStatus" style="color:#007c4d;"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-project.firebaseapp.com",
      databaseURL: "https://your-project.firebaseio.com",
      projectId: "your-project"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function loadModel() {
      const modelURL = "https://your-storage.com/tflite/converted-model/model.json";  // 실제 TFLite converted model
      const model = await tf.loadGraphModel(modelURL);
      document.getElementById("modelStatus").innerText = "✅ 작물 모델 로드 완료!";
    }

    db.ref("reports").on("value", (snapshot) => {
      const data = snapshot.val();
      const labels = [], values = [];
      for (const key in data) {
        labels.push(new Date(data[key].time).toLocaleString());
        values.push(data[key].summary?.length || 1);
      }
      const ctx = document.getElementById("reportChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "제출된 보고서 요약 길이",
            data: values,
            backgroundColor: "#007c4d"
          }]
        },
        options: { responsive: true }
      });
    });

    async function sendToFunction() {
      const email = document.getElementById("email").value;
      const summary = document.getElementById("summary").value;
      const res = await fetch("https://us-central1-your-project.cloudfunctions.net/processReport", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, summary, time: new Date().toISOString() })
      });
      const data = await res.json();
      document.getElementById("fnStatus").innerText = "📩 처리 결과: " + data.status;
    }
  </script>

</body>
</html>
