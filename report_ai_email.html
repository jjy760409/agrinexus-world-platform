
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriNexus AI Report with Email + Save</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <nav>
    <a href="index.html">ğŸ  Home</a> |
    <a href="report_ai_email.html">ğŸ“¨ AI Email</a> |
    <a href="report_admin_dashboard.html">ğŸ“‹ Admin</a>
  </nav>
  <h1>ğŸ§  AI ìš”ì•½ + ì´ë©”ì¼ ì „ì†¡ + Firebase ì €ì¥</h1>
  <textarea id="reportText" rows="8" cols="80" placeholder="ë¶„ì„í•  ì›ë³¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><br>
  <button onclick="generateSummary()">ğŸ§  AI ìš”ì•½</button>
  <p><b>ìš”ì•½ ê²°ê³¼:</b></p>
  <div id="summaryBox" style="border:1px solid #ccc; padding:10px;"></div>
  <input type="email" id="emailTarget" placeholder="ë°›ëŠ” ì´ë©”ì¼ ì£¼ì†Œ" /><br>
  <button onclick="sendEmail()">ğŸ“§ PDF ì²¨ë¶€ ì´ë©”ì¼ ì „ì†¡</button>

  <script type="module">
    import {{ initializeApp }} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import {{ getDatabase, ref, push }} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {{
      apiKey: "AIzaSyAIzOk9HBBW...JzTpk",
      authDomain: "agrinexus-world-aa9b2.firebaseapp.com",
      projectId: "agrinexus-world-aa9b2",
      storageBucket: "agrinexus-world-aa9b2.appspot.com",
      messagingSenderId: "440786913965",
      appId: "1:440786913965:web:d0d57105ee32999b5ad424",
      databaseURL: "https://agrinexus-world-aa9b2-default-rtdb.firebaseio.com"
    }};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let summaryText = "";

    async function generateSummary() {{
      const input = document.getElementById("reportText").value;
      document.getElementById("summaryBox").innerText = "ìš”ì•½ ì¤‘...";
      const res = await fetch("https://api.openai.com/v1/completions", {{
        method: "POST",
        headers: {{
          "Content-Type": "application/json",
          "Authorization": "Bearer YOUR_OPENAI_KEY"
        }},
        body: JSON.stringify({{
          model: "text-davinci-003",
          prompt: "ì•„ë˜ ë‚´ìš©ì„ 3ì¤„ë¡œ ìš”ì•½í•˜ì„¸ìš”:\n" + input,
          max_tokens: 150
        }})
      }});
      const data = await res.json();
      summaryText = data.choices?.[0]?.text || "ìš”ì•½ ì‹¤íŒ¨";
      document.getElementById("summaryBox").innerText = summaryText;

      // ì €ì¥
      push(ref(db, "ai_summary_logs/"), {{
        original: input,
        summary: summaryText,
        time: new Date().toISOString()
      }});
    }}

    function sendEmail() {{
      const emailTo = document.getElementById("emailTarget").value;
      const {{ jsPDF }} = window.jspdf;
      const doc = new jsPDF();
      doc.text("ğŸ“„ AgriNexus AI Summary", 10, 10);
      doc.text(summaryText, 10, 20);
      const blob = doc.output("blob");

      emailjs.send("your_service_id", "your_template_id", {{
        to_email: emailTo,
        subject: "AgriNexus AI Summary Report",
        message: summaryText
      }}, "your_public_key").then(() => {{
        alert("ğŸ“§ ì´ë©”ì¼ ì „ì†¡ ì™„ë£Œ!");
      }}, (err) => {{
        alert("âŒ ì´ë©”ì¼ ì „ì†¡ ì‹¤íŒ¨: " + JSON.stringify(err));
      }});
    }}

    emailjs.init("your_public_key");
  </script>
</body>
</html>
